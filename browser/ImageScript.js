!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ImageScript=e():t.ImageScript=e()}(self,(function(){return t={655:(t,e,r)=>{const i=r(347),s=r(723),n=r(876),o=r(327),h=r(76),a=r(667);class l{constructor(t,e){if(e=~~e,(t=~~t)<1)throw new RangeError("Image has to be at least 1 pixel wide");if(e<1)throw new RangeError("Image has to be at least 1 pixel high");this.__width__=t,this.__height__=e,this.__buffer__=new ArrayBuffer(t*e*4),this.__view__=new DataView(this.__buffer__),this.__u32__=new Uint32Array(this.__buffer__),this.bitmap=new Uint8ClampedArray(this.__buffer__)}toString(){return`Image<${this.width}x${this.height}>`}static new(t,e){return new this(t,e)}get width(){return this.__width__}get height(){return this.__height__}*[Symbol.iterator](){for(let t=1;t<=this.height;t++)for(let e=1;e<=this.width;e++)yield[e,t]}*iterateWithColors(){let t=0;for(let e=1;e<=this.height;e++)for(let r=1;r<=this.width;r++)yield[r,e,this.__view__.getUint32(t,!1)],t+=4}static rgbaToColor(t,e,r,i){return((255&t)<<24|(255&e)<<16|(255&r)<<8|255&i)>>>0}static rgbToColor(t,e,r){return l.rgbaToColor(t,e,r,255)}static hslaToColor(t,e,r,i){let s,n,o;if(t%=1,e=Math.min(1,Math.max(0,e)),r=Math.min(1,Math.max(0,r)),i=Math.min(1,Math.max(0,i)),0===e)s=n=o=r;else{const i=(t,e,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t),h=r<.5?r*(1+e):r+e-r*e,a=2*r-h;s=i(a,h,t+1/3),n=i(a,h,t),o=i(a,h,t-1/3)}return l.rgbaToColor(255*s,255*n,255*o,255*i)}static hslToColor(t,e,r){return l.hslaToColor(t,e,r,1)}static rgbaToHSLA(t,e,r,i){t/=255,e/=255,r/=255;const s=Math.max(t,e,r),n=Math.min(t,e,r);let o,h,a=(s+n)/2;if(s===n)o=h=0;else{const i=s-n;switch(h=a>.5?i/(2-s-n):i/(s+n),s){case t:o=(e-r)/i+(e<r?6:0);break;case e:o=(r-t)/i+2;break;case r:o=(t-e)/i+4}o/=6}return[o,h,a,i/255]}static colorToRGBA(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}static colorToRGB(t){return l.colorToRGBA(t).slice(0,3)}getPixelAt(t,e){return this.__check_boundaries__(t,e),this.__view__.getUint32((~~e-1)*this.width+(~~t-1),!1)}getRGBAAt(t,e){this.__check_boundaries__(t,e);const r=4*((~~e-1)*this.width+(~~t-1));return this.bitmap.subarray(r,r+4)}setPixelAt(t,e,r){return t=~~t,e=~~e,this.__check_boundaries__(t,e),this.__set_pixel__(t,e,r),this}__set_pixel__(t,e,r){this.__view__.setUint32(4*((e-1)*this.width+(t-1)),r,!1)}__check_boundaries__(t,e){if(isNaN(t))throw new TypeError(`Invalid pixel coordinates (x=${t})`);if(isNaN(e))throw new TypeError(`Invalid pixel coordinates (y=${e})`);if(t<1)throw new RangeError(`${l.__out_of_bounds__} (x=${t})<1`);if(t>this.width)throw new RangeError(`${l.__out_of_bounds__} (x=${t})>(width=${this.width})`);if(e<1)throw new RangeError(`${l.__out_of_bounds__} (y=${e})<1`);if(e>this.height)throw new RangeError(`${l.__out_of_bounds__} (y=${e})>(height=${this.height})`)}static get __out_of_bounds__(){return"Tried referencing a pixel outside of the images boundaries:"}fill(t){if("function"!=typeof t)this.__view__.setUint32(0,t,!1),this.__u32__.fill(this.__u32__[0]);else{let e=0;for(let r=1;r<=this.height;r++)for(let i=1;i<=this.width;i++)this.__view__.setUint32(e,t(i,r),!1),e+=4}return this}clone(){const t=l.new(this.width,this.height);return t.bitmap.set(this.bitmap),t}static get RESIZE_NEAREST_NEIGHBOR(){return"RESIZE_NEAREST_NEIGHBOR"}static get RESIZE_AUTO(){return-1}scale(t,e=l.RESIZE_NEAREST_NEIGHBOR){const r=this.__scale__(t,e);return this.__apply__(r)}__scale__(t,e=l.RESIZE_NEAREST_NEIGHBOR){return 1===t?this:this.__resize__(this.width*t,this.height*t,e)}resize(t,e,r=l.RESIZE_NEAREST_NEIGHBOR){const i=this.__resize__(t,e,r);return this.__apply__(i)}__resize__(t,e,r=l.RESIZE_NEAREST_NEIGHBOR){if(t===l.RESIZE_AUTO&&e===l.RESIZE_AUTO)throw new Error("RESIZE_AUTO can only be used for either width or height, not for both");if(t===l.RESIZE_AUTO?t=this.width/this.height*e:e===l.RESIZE_AUTO&&(e=this.height/this.width*t),t=Math.floor(t),e=Math.floor(e),t<1)throw new RangeError("Image has to be at least 1 pixel wide");if(e<1)throw new RangeError("Image has to be at least 1 pixel high");let i;if(r!==l.RESIZE_NEAREST_NEIGHBOR)throw new Error("Invalid resize mode");return i=this.__resize_nearest_neighbor__(t,e),i}__resize_nearest_neighbor__(t,e){const r=new this.constructor(t,e);for(let i=0;i<e;i++)for(let s=0;s<t;s++){const n=Math.floor(i*this.height/e),o=Math.floor(s*this.width/t),h=4*(i*t+s),a=4*(n*this.width+o);r.__view__.setUint32(h,this.__view__.getUint32(a,!1),!1)}return r}crop(t,e,r,i){return r>this.width&&(r=this.width),i>this.height&&(i=this.height),this.__apply__(this.__crop__(t,e,r,i))}__crop__(t,e,r,i){t=~~t,e=~~e;const s=new this.constructor(r,i);for(let n=0;n<i;n++){const i=(n+e)*this.width+t;s.__u32__.set(this.__u32__.subarray(i,i+r),n*r)}return s}drawBox(t,e,r,i,s){if(t-=1,e-=1,"function"!=typeof s)return this.__fast_box__(t,e,r,i,s);for(let n=1;n<=i;n++)for(let i=1;i<=r;i++){const r=i+t,o=n+e;if(Math.min(r,o)<1||r>this.width||o>this.height)continue;const h=s(i,n);this.__set_pixel__(r,o,h)}return this}__fast_box__(t,e,r,i,s){t<0&&(r+=t,t=1),e<0&&(i+=e,e=1);const n=Math.max(Math.min(t+r,this.width),1);let o=n;for(;t<=--o;)this.__view__.setUint32(4*(o+e*this.width),s);const h=4*(n+e*this.width),a=4*(t+e*this.width);let l=Math.max(Math.min(e+i,this.height),1);for(;e<--l;)this.bitmap.copyWithin(4*(t+l*this.width),a,h);return this}drawCircle(t,e,r,i){const s=r**2;for(let n=Math.max(1,e-r);n<=Math.min(e+r,this.height);n++)for(let o=Math.max(1,t-r);o<=Math.min(t+r,this.width);o++)(o-t)**2+(n-e)**2<s&&this.__set_pixel__(o,n,"function"==typeof i?i(o-t+r,n-e+r):i);return this}cropCircle(t=!1,e=0){const r=(Math[t?"max":"min"](this.width,this.height)/2)**2,i=this.width/2,s=this.height/2;for(const[t,n]of this){const o=(t-i)**2+(n-s)**2,h=4*((n-1)*this.width+(t-1))+3;o>r?this.bitmap[h]=0:e&&(this.bitmap[h]*=Math.max(0,Math.min(1,1-o/r*e**.5)))}return this}opacity(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid opacity value");return this.__set_channel_value__(t,e,3),this}red(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.__set_channel_value__(t,e,0),this}green(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.__set_channel_value__(t,e,1),this}blue(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.__set_channel_value__(t,e,2),this}__set_channel_value__(t,e,r){for(let i=r;i<this.bitmap.length;i+=4)this.bitmap[i]=t*(e?255:this.bitmap[i])}lightness(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid lightness value");return this.fill(((r,i)=>{const[s,n,o,h]=l.rgbaToHSLA(...this.getRGBAAt(r,i));return l.hslaToColor(s,n,t*(e?1:o),h)}))}saturation(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.fill(((r,i)=>{const[s,n,o,h]=l.rgbaToHSLA(...this.getRGBAAt(r,i));return l.hslaToColor(s,t*(e?1:n),o,h)}))}composite(t,e=0,r=0){e=~~e,r=~~r;for(let i=0;i<t.height;i++){let s=r+i;if(!(s<0)){if(s>=this.height)break;for(let r=0;r<t.width;r++){let n=e+r;if(n<0)continue;if(n>=this.width)break;const o=4*(n+s*this.width),h=t.__view__.getUint32(4*(r+i*t.width),!1),a=this.__view__.getUint32(o,!1);255==(255&h)?this.__view__.setUint32(o,h,!1):0==(255&h)?this.__view__.setUint32(o,a,!1):this.__view__.setUint32(o,l.__alpha_blend__(h,a),!1)}}}return this}static __alpha_blend__(t,e){const r=255&t,i=r+1,s=256-r;return(255&i*(t>>>24)+s*(e>>>24)>>8)<<24|(255&i*(t>>16&255)+s*(e>>16&255)>>8)<<16|(255&i*(t>>8&255)+s*(e>>8&255)>>8)<<8|255&Math.max(r,255&e)}invert(){for(const[t,e,r]of this.iterateWithColors())this.__set_pixel__(t,e,4294967295-r&4294967040|255&r);return this}invertValue(){for(const[t,e,r]of this.iterateWithColors()){const[i,s,n,o]=l.rgbaToHSLA(...l.colorToRGBA(r));this.__set_pixel__(t,e,l.hslaToColor(i,s,1-n,o))}return this}invertSaturation(){for(const[t,e,r]of this.iterateWithColors()){const[i,s,n,o]=l.rgbaToHSLA(...l.colorToRGBA(r));this.__set_pixel__(t,e,l.hslaToColor(i,1-s,n,o))}return this}invertHue(){for(const[t,e,r]of this.iterateWithColors()){const[i,s,n,o]=l.rgbaToHSLA(...l.colorToRGBA(r));this.__set_pixel__(t,e,l.hslaToColor(1-i,s,n,o))}return this}hueShift(t){for(const[e,r,i]of this.iterateWithColors()){const[s,n,o,h]=l.rgbaToHSLA(...l.colorToRGBA(i));this.__set_pixel__(e,r,l.hslaToColor(s+t/360,n,o,h))}return this}averageColor(){let t=[0,0,0],e=0;for(let r=0;r<this.bitmap.length;r+=4){const i=this.bitmap.subarray(r,r+4);for(let e=0;e<3;e++)t[e]+=i[e];e+=i[3]/255}return l.rgbaToColor(...t.map((t=>t/e)),255)}dominantColor(t=!0,e=!0,r=15){const i=new Array(262143);for(let s=0;s<this.bitmap.length;s+=4){const n=this.__view__.getUint32(s,!1),[o,h,a]=l.rgbaToHSLA(...l.colorToRGBA(n)).map((t=>~~(63*t)));if(t&&a<r)continue;if(e&&a>63-r)continue;const _=o<<12|h<<6|a;i[_]=(i[_]||0)+1}let s=-1,n=0;if(i.forEach(((t,e)=>{t<s||(s=t,n=e)})),-1===n)return this.dominantColor(t,e,r-1);const o=n>>>12&63,h=n>>>6&63,a=63&n;return l.hslaToColor(o/63,h/63,a/63,1)}rotate(t,e=!0){if(t%360==0)return this;if(t%180==0)return this.__rotate_180__();const r=Math.PI*(t/180),i=Math.sin(r),s=Math.cos(r),n=e?Math.abs(this.width*i)+Math.abs(this.height*s):this.width,o=e?Math.abs(this.width*s)+Math.abs(this.height*i):this.height,h=l.new(n,o),a=n/2-.5,_=o/2-.5,c=this.width/2-.5,f=this.height/2-.5;let u=0;do{let t=0;const e=c-i*(u-_),r=f+s*(u-_);do{const n=e+s*(t-a),o=r+i*(t-a);l.__interpolate__(this,h,t,u,n,o)}while(t++<n)}while(u++<o);return this.__apply__(h)}__rotate_180__(){let t=0;for(this.bitmap.reverse();t<this.bitmap.length;)this.bitmap.subarray(t,t+=4).reverse();return this}static __interpolate__(t,e,r,i,s,n){const o=~~s,h=~~n,a=s-o,_=n-h,c=e.bitmap.subarray(4*(r+i*e.width),-4),f={r:0,g:0,b:0,a:0};l.__pawn__(o,h,(1-a)*(1-_),f,t),l.__pawn__(1+o,h,a*(1-_),f,t),l.__pawn__(o,1+h,(1-a)*_,f,t),l.__pawn__(1+o,1+h,a*_,f,t),c[3]=f.a,c[0]=f.r/f.a,c[1]=f.g/f.a,c[2]=f.b/f.a}static __pawn__(t,e,r,i,s){if(t>0&&e>0&&t<s.width&&e<s.height){const n=4*(t+e*s.width),o=s.bitmap.subarray(n,n+4),h=r*o[3];i.a+=h,i.r+=h*o[0],i.g+=h*o[1],i.b+=h*o[2]}}__apply__(t){return this.__width__=t.__width__,this.__height__=t.__height__,this.__view__=t.__view__,this.__u32__=t.__u32__,this.bitmap=t.bitmap,this}static gradient(t){const e=Object.entries(t).sort(((t,e)=>t[0]-e[0])),r=e.map((t=>parseFloat(t[0]))),i=e.map((t=>t[1]));if(0===r.length)throw new RangeError("Invalid gradient point count");if(1===r.length)return()=>i[0];if(2===r.length){const t=this.__gradient__(i[0],i[1]);return e=>e<=r[0]?i[0]:e>=r[1]?i[1]:t((e-r[0])/(r[1]-r[0]))}const s=Math.min(...r),n=Math.max(...r);let o=[];for(let t=0;t<r.length;t++){let e=r[t-1];if(void 0===e)continue;let s=r[t],n=i[t-1];void 0===n&&(n=i[t]);const h=i[t],a=this.__gradient__(n,h);o.push({min:e,max:s,gradient:a})}return t=>{if(t<=s)return o[0].gradient(0);if(t>=n)return o[o.length-1].gradient(1);for(const e of o)if(t>=e.min&&t<=e.max)return e.gradient((t-e.min)/(e.max-e.min));throw new RangeError(`Invalid gradient position: ${t}`)}}roundCorners(t=Math.min(this.width,this.height)/4){const e=t**2;for(let r=1;r<=t;r++){const i=(r-t)**2;for(let s=1;s<=t;s++)i+(s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+r-1)+3]=0)}for(let r=1;r<=t;r++){const i=(r-t)**2;for(let s=this.height-t;s<=this.height;s++)i+(this.height-s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+r-1)+3]=0)}for(let r=this.width-t;r<=this.width;r++){const i=(this.width-r-t)**2;for(let s=1;s<=t;s++)i+(s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+r-1)+3]=0)}for(let r=this.width-t;r<=this.width;r++){const i=(this.width-r-t)**2;for(let s=this.height-t;s<=this.height;s++)i+(this.height-s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+r-1)+3]=0)}return this}static __gradient__(t,e){const r=t>>>24,i=t>>16&255,s=t>>8&255,n=255&t,o=(e>>>24)-r,h=(e>>16&255)-i,a=(e>>8&255)-s,l=(255&e)-n;return t=>(255&r+t*o)<<24|(255&i+t*h)<<16|(255&s+t*a)<<8|255&n+t*l}async encode(t=1){return await i.encode(this.bitmap,{width:this.width,height:this.height,level:t,channels:4})}async encodeJPEG(t=90){return await o.init(),o.encode(this.bitmap,this.width,this.height,Math.max(1,Math.min(100,t)))}static async decode(t){let e,r;if(ArrayBuffer.isView(t)?(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=new DataView(t.buffer,t.byteOffset,t.byteLength)):(t=new Uint8Array(t),r=new DataView(t.buffer)),2303741511===r.getUint32(0,!1)){const{width:r,height:s,pixels:n}=await i.decode(t);e=new this(r,s),e.bitmap.set(n)}else if(r.getUint32(0,!1)>>>8==16767231){await o.init();const r=o.decode(t),i=r.width,s=r.height,n=r.format;e=new this(i,s);const h=r.buffer;if(0===n){const t=new DataView(e.bitmap.buffer);for(let e=0;e<h.length;e++){const r=h[e];t.setUint32(4*e,r<<24|r<<16|r<<8|255,!1)}}else if(1===n){e.bitmap.fill(255);for(let t=0;t<i*s;t++)e.bitmap.set(h.subarray(3*t,3*t+3),4*t)}else if(2===n)for(let t=0;t<h.length;t+=4)e.bitmap[t]=255*(1-h[t]/255)*(1-h[t+3]/255),e.bitmap[t+1]=255*(1-h[t+1]/255)*(1-h[t+3]/255),e.bitmap[t+2]=255*(1-h[t+2]/255)*(1-h[t+3]/255),e.bitmap[t+3]=255}else{if(1229531648!==r.getUint32(0,!1))throw new Error("Unsupported image type");{await h.init();const r=h.decode(t);e=new this(r.width,r.height),e.bitmap.set(r.buffer)}}return e}static get SVG_MODE_SCALE(){return 1}static get SVG_MODE_WIDTH(){return 2}static get SVG_MODE_HEIGHT(){return 3}static async renderSVG(t,e=1,r=this.SVG_MODE_SCALE){if(![this.SVG_MODE_WIDTH,this.SVG_MODE_HEIGHT,this.SVG_MODE_SCALE].includes(r))throw new Error("Invalid SVG scaling mode");if(r===this.SVG_MODE_SCALE&&e<=0)throw new RangeError("SVG scale must be > 0");if(r!==this.SVG_MODE_SCALE&&e<1)throw new RangeError("SVG size must be >= 1");"string"==typeof t&&(t=(new TextEncoder).encode(t)),await n.init();const i=n.rasterize(t,r,e),s=new this(i.width,i.height);return s.bitmap.set(i.buffer),s}static get WRAP_STYLE_CHAR(){return!0}static get WRAP_STYLE_WORD(){return!1}static async renderText(t,e,r,i=4294967295,n=1/0,o=this.WRAP_STYLE_WORD){await s.init(),t=new s.Font(e,t);const[h,a,_,c]=l.colorToRGBA(i),f=new s.Layout;f.reset({wrap_style:o?"word":"letter",max_width:1/0===n?null:n}),f.append(t,r,e);const u=f.rasterize(h,a,_),w=new this(u.width,u.height);return w.bitmap.set(u.buffer),t.free(),f.free(),w.opacity(c/255)}}class _ extends l{constructor(t,e,r=100){if(isNaN(r)||r<0)throw new RangeError("Invalid frame duration");super(t,e),this.duration=r}toString(){return`Frame<${this.width}x${this.height}x${this.duration}ms>`}static from(t,e){if(!(t instanceof l))throw new TypeError("Invalid image passed");const r=new _(t.width,t.height,e);return r.bitmap.set(t.bitmap),r}}class c extends Array{constructor(t,e=-1){super(...t),this.width=t[0].width,this.height=t[0].height;for(const t of this){if(!(t instanceof _))throw new TypeError(`Frame ${this.indexOf(t)} is not an instance of Frame`);if(t.width!==this.width)throw new Error("Frames have different widths");if(t.height!==this.height)throw new Error("Frames have different heights")}if(e<-1||isNaN(e))throw new RangeError("Invalid loop count");this.loopCount=e}toString(){return`GIF<${this.width}x${this.height}x${this.duration}ms>`}get duration(){return[...this].reduce(((t,e)=>t+e.duration),0)}async encode(t=10){await a.init();const e=new a.Encoder(this.width,this.height,this.loopCount);for(const r of this){if(!(r instanceof _))throw new Error("GIF contains invalid frames");e.add(~~(r.duration/10),r.width,r.height,r.bitmap,t)}return e.u8()}static async decode(t){let e,r;if(ArrayBuffer.isView(t)?(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=new DataView(t.buffer,t.byteOffset,t.byteLength)):(t=new Uint8Array(t),r=new DataView(t.buffer)),r.getUint32(0,!1)>>>8!=4671814)throw new Error("Unsupported image type");{const r=new a.Decoder(t),i=[];for(const t of r.frames()){const e=new _(t.width,t.height,t.delay);e.bitmap.set(t.buffer),i.push(e)}e=new c(i)}return e}}t.exports={Image:l,GIF:c,Frame:_}},306:t=>{"use strict";t.exports=JSON.parse('{"name":"imagescript","version":"1.1.16","description":"zero-dependency javascript image manipulation","main":"ImageScript.js","type":"commonjs","scripts":{"build":"webpack"},"repository":{"type":"git","url":"git+https://github.com/matmen/ImageScript.git"},"keywords":["image","image processing","image manipulation"],"author":"matmen <matmen@dreadful.tech>","license":"GPL-3.0-or-later","bugs":{"url":"https://github.com/matmen/ImageScript/issues"},"homepage":"https://github.com/matmen/ImageScript#readme","engines":{"node":">=12.0.0"}}')},354:t=>{t.exports=class{static concat(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let r=0;for(const i of t)e.set(i,r),r+=i.length;return e}}},883:t=>{const e=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);t.exports=function(t){let r=0,i=4294967295;for(;r<t.length-4;)i=e[255&(i^t[r++])]^i>>>8,i=e[255&(i^t[r++])]^i>>>8,i=e[255&(i^t[r++])]^i>>>8,i=e[255&(i^t[r++])]^i>>>8;for(;r<t.length;)i=e[255&(i^t[r++])]^i>>>8;return(4294967295^i)>>>0}},347:(t,e,r)=>{const i=r(883),s=r(354),{init:n,compress:o,decompress:h}=r(423),a=new Uint8Array([73,72,68,82]),l=new Uint8Array([73,68,65,84]),_=new Uint8Array([73,69,78,68]),c=i(new Uint8Array([73,69,78,68])),f=new Uint8Array([137,80,78,71,13,10,26,10]),u={1:0,2:4,3:2,4:6};t.exports={async encode(t,{width:e,height:r,channels:s,depth:h=8,level:w=0}){let g=0,d=0;const m=e*s,p=new Uint8Array(r+t.length);for(;g<t.length;)p[d++]=0,p.set(t.subarray(g,g+=m),d),d+=m;await n();const b=o(p,w),y=new Uint8Array(49+f.length+b.length);y[26]=0,y[27]=0,y[28]=0,y[24]=h,y.set(f,0),y.set(a,12),y.set(l,37),y.set(b,41),y.set(_,49+b.length),y[25]=u[s];const E=new DataView(y.buffer);return E.setUint32(8,13),E.setUint32(16,e),E.setUint32(20,r),E.setUint32(33,b.length),E.setUint32(45+b.length,0),E.setUint32(53+b.length,c),E.setUint32(29,i(new Uint8Array(y.buffer,12,17))),E.setUint32(41+b.length,i(new Uint8Array(y.buffer,37,4+b.length))),y},async decode(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);const r=e.getUint32(16),i=e.getUint32(20),o=t[24],a=t[25];let l={3:1,0:1,4:2,2:3,6:4}[a];const _=l*o/8,c=r*_;let f=new Uint8Array(i*c),u=0,w=0,g=33;const d=[];let m,p,b;for(;1229278788!==b;){if(b=e.getUint32(4+g),1229209940===b)d.push(t.subarray(8+g,8+g+e.getUint32(g)));else if(1347179589===b){if(m)throw new Error("PLTE can only occur once in an image");m=new Uint32Array(e.getUint32(g));for(let e=0;e<8*m.length;e+=3)m[e/3]=t[8+g+e]<<24|t[8+g+e+1]<<16|t[8+g+e+2]<<8|255}else if(1951551059===b){if(p)throw new Error("tRNS can only occur once in an image");p=new Uint8Array(e.getUint32(g));for(let e=0;e<p.length;e++)p[e]=t[8+g+e]}g+=12+e.getUint32(g)}for(await n(),t=h(1===d.length?d[0]:s.concat(...d));u<t.byteLength;){const e=t[u++],r=t.subarray(u,u+=c);0===e?f.set(r,w):1===e?this.filter_1(r,f,w,_,c):2===e?this.filter_2(r,f,w,_,c):3===e?this.filter_3(r,f,w,_,c):4===e&&this.filter_4(r,f,w,_,c),w+=c}if(3===a){if(!m)throw new Error("Indexed color PNG has no PLTE");if(p)for(let t=0;t<p.length;t++)m[t]&=4294967040|p[t];l=4;const t=new Uint8Array(r*i*4),e=new DataView(t.buffer,t.byteOffset,t.byteLength);for(let t=0;t<f.length;t++)e.setUint32(4*t,m[f[t]],!1);f=t}if(8!==o){const t=new Uint8Array(f.length/o*8);for(let e=0;e<f.length;e+=2)t[e/2]=f[e];f=t}if(4!==l){const t=new Uint8Array(r*i*4),e=new DataView(t.buffer);if(1===l)for(let t=0;t<r*i;t++){const r=f[t];e.setUint32(4*t,r<<24|r<<16|r<<8|255,!1)}else if(2===l)for(let t=0;t<r*i*2;t+=2){const r=f[t];e.setUint32(2*t,r<<24|r<<16|r<<8|f[t+1],!1)}else if(3===l){t.fill(255);for(let e=0;e<r*i;e++)t.set(f.subarray(3*e,3*e+3),4*e)}f=t}return{width:r,height:i,pixels:f}},filter_1(t,e,r,i,s){let n=0;for(;n<i;)e[n+r]=t[n++];for(;n<s;)e[n+r]=t[n]+e[n+++r-i]},filter_2(t,e,r,i,s){if(0===r)e.set(t,r);else{let i=0;for(;i<s;)e[i+r]=t[i]+e[i+++r-s]}},filter_3(t,e,r,i,s){let n=0;if(0===r){for(;n<i;)e[n]=t[n++];for(;n<s;)e[n]=t[n]+(e[n++-i]>>1)}else{for(;n<i;)e[n+r]=t[n]+(e[n+++r-s]>>1);for(;n<s;)e[n+r]=t[n]+(e[n+r-i]+e[n+++r-s]>>1)}},filter_4(t,e,r,i,s){let n=0;if(0===r){for(;n<i;)e[n]=t[n++];for(;n<s;)e[n]=t[n]+e[n++-i]}else{for(;n<i;)e[n+r]=t[n]+e[n+++r-s];for(;n<s;){const o=e[n+r-i],h=e[n+r-s],a=e[n+r-i-s],l=o+h-a,_=Math.abs(l-o),c=Math.abs(l-h),f=Math.abs(l-a);e[n+r]=t[n++]+(_<=c&&_<=f?o:c<=f?h:a)}}}}},723:(t,e,r)=>{const{version:i}=r(306);let s,n=null;class o{static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static length(){return new Uint32Array(s.memory.buffer,s.cur_len.value,1)[0]}static copy_and_free(t,e){let r=o.u8(t,e).slice();return s.wfree(t,e),r}}const h="Deno"in globalThis?Deno.core.encode:(()=>{const t=new TextEncoder;return e=>t.encode(e)})(),a="Deno"in globalThis?Deno.core.decode:(()=>{const t=new TextDecoder;return e=>t.decode(e)})();"FinalizationRegistry"in globalThis&&(n=new FinalizationRegistry((([t,e])=>{0===t&&s.font_free(e),1===t&&s.layout_free(e)}))),t.exports={Font:class{constructor(t,e){this.scale=t;const r=o.alloc(e.length);if(o.u8(r,e.length).set(e),this.ptr=s.font_new(r,e.length,t),!this.ptr)throw new Error("invalid font");n&&n.register(this,[0,this.ptr],this)}free(){this.ptr=s.font_free(this.ptr),n&&n.unregister(this)}has(t){return s.font_has(this.ptr,String.prototype.charCodeAt.call(t,0))}metrics(t,e=this.scale){const r=s.font_metrics(this.ptr,String.prototype.charCodeAt.call(t,0),e),i=JSON.parse(a(o.u8(s.font_metrics_buffer(r),o.length())));return s.font_metrics_free(r),i}rasterize(t,e=this.scale){const r=s.font_rasterize(this.ptr,String.prototype.charCodeAt.call(t,0),e),i={buffer:o.u8(s.font_rasterize_buffer(r),o.length()).slice(),metrics:JSON.parse(a(o.u8(s.font_rasterize_metrics(r),o.length())))};return s.font_rasterize_free(r),i}},Layout:class{constructor(){this.ptr=s.layout_new(),n&&(this.refs=[]),n&&n.register(this,[1,this.ptr],this)}clear(){s.layout_clear(this.ptr),n&&(this.refs.length=0)}lines(){return s.layout_lines(this.ptr)}free(){n&&(this.refs.length=0),this.ptr=s.layout_free(this.ptr),n&&n.unregister(this)}reset(t={}){t=h(JSON.stringify(t)),n&&(this.refs.length=0);const e=o.alloc(t.length);o.u8(e,t.length).set(t),s.layout_reset(this.ptr,e,t.length)}append(t,e,r){e=h(e),n&&this.refs.push(t);const i=o.alloc(e.length);o.u8(i,e.length).set(e),s.layout_append(this.ptr,t.ptr,i,e.length,null!=r?r:t.scale)}rasterize(t,e,r){const i=s.layout_rasterize(this.ptr,t,e,r),n={width:s.layout_rasterize_width(i),height:s.layout_rasterize_height(i),buffer:o.u8(s.layout_rasterize_buffer(i),o.length()).slice()};return s.layout_rasterize_free(i),n}},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${i}/utils/wasm/font.wasm`).then((e=>t?e:e.arrayBuffer()))),r=new WebAssembly.Instance(e);s=r.exports}}},667:(t,e,r)=>{const{version:i}=r(306);let s;const n=new Map;class o{static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static length(){return new Uint32Array(s.memory.buffer,s.cur_len.value,1)[0]}static copy_and_free(t,e){let r=o.u8(t,e).slice();return s.wfree(t,e),r}}t.exports={Encoder:class{constructor(t,e,r=-1){this.slices=[],n.set(0,this),this.ptr=s.encoder_new(0,t,e,r)}cb(t){this.slices.push(t)}free(){this.ptr=s.encoder_free(this.ptr),n.delete(0)}u8(){this.free();let t=0;const e=new Uint8Array(this.slices.reduce(((t,e)=>t+e.length),0));for(const r of this.slices)e.set(r,t),t+=r.length;return e}add(t,e,r,i,n){const h=o.alloc(i.length);o.u8(h,i.length).set(i),s.encoder_add(this.ptr,h,i.length,e,r,t,n)}},Decoder:class{constructor(t,e=0){const r=o.alloc(t.length);if(o.u8(r,t.length).set(t),this.ptr=s.decoder_new(r,t.length,e),0===this.ptr)throw new Error("gif: failed to parse gif header");this.width=s.decoder_width(this.ptr),this.height=s.decoder_height(this.ptr)}free(){this.ptr=s.decoder_free(this.ptr)}*frames(){let t;for(;t=this.frame();)yield t;this.free()}frame(){const t=s.decoder_frame(this.ptr);if(1===t)return null;if(0===t)throw this.free(),new Error("gif: failed to decode frame");const e={delay:s.decoder_frame_delay(t),width:s.decoder_frame_width(t),height:s.decoder_frame_height(t),buffer:o.u8(s.decoder_frame_buffer(t),o.length()).slice()};return s.decoder_frame_free(t),e}},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${i}/utils/wasm/gif.wasm`).then((e=>t?e:e.arrayBuffer()))),r=new WebAssembly.Instance(e,{env:{push_to_stream(t,e){n.get(t).cb(o.u8(e,o.length()).slice())}}});s=r.exports}}},327:(t,e,r)=>{const{version:i}=r(306);let s;class n{static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static length(){return new Uint32Array(s.memory.buffer,s.cur_len.value,1)[0]}static copy_and_free(t,e){let r=n.u8(t,e).slice();return s.wfree(t,e),r}}t.exports={encode:function(t,e,r,i){const o=n.alloc(t.length);return n.u8(o,t.length).set(t),n.copy_and_free(s.encode(o,e,r,i),n.length())},decode:function(t,e,r){const i=n.alloc(t.length);n.u8(i,t.length).set(t);const o=s.decode(i,t.length,e,r);if(0===o)throw new Error("jpg: failed to decode");if(1===o)throw new Error("jpg: failed to scale decoder");const h={width:s.decode_width(o),height:s.decode_height(o),format:s.decode_format(o),buffer:n.u8(s.decode_buffer(o),n.length()).slice()};return s.decode_free(o),h},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${i}/utils/wasm/jpeg.wasm`).then((e=>t?e:e.arrayBuffer()))),r=new WebAssembly.Instance(e);s=r.exports}}},876:(t,e,r)=>{const{version:i}=r(306);let s;class n{static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static length(){return new Uint32Array(s.memory.buffer,s.cur_len.value,1)[0]}static copy_and_free(t,e){let r=n.u8(t,e).slice();return s.wfree(t,e),r}}t.exports={rasterize:function(t,e,r){const i=n.alloc(t.length);n.u8(i,t.length).set(t);const o=s.rasterize(i,t.length,e,r);if(0===o)throw new Error("svg: failed to parse");if(1===o)throw new Error("svg: failed to rasterize");const h={width:s.rasterize_width(o),height:s.rasterize_height(o),buffer:n.u8(s.rasterize_buffer(o),n.length()).slice()};return s.rasterize_free(o),h},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${i}/utils/wasm/svg.wasm`).then((e=>t?e:e.arrayBuffer()))),r=new WebAssembly.Instance(e);s=r.exports}}},76:(t,e,r)=>{const{version:i}=r(306);let s;class n{static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static length(){return new Uint32Array(s.memory.buffer,s.cur_len.value,1)[0]}static copy_and_free(t,e){let r=n.u8(t,e).slice();return s.wfree(t,e),r}}t.exports={decode:function(t){const e=n.alloc(t.length);n.u8(e,t.length).set(t);const r=s.decode(e,t.length);if(0===r)throw new Error("tiff: failed to decode");const i={width:s.decode_width(r),height:s.decode_height(r),buffer:n.u8(s.decode_buffer(r),n.length()).slice()};return s.decode_free(r),i},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${i}/utils/wasm/tiff.wasm`).then((e=>t?e:e.arrayBuffer()))),r=new WebAssembly.Instance(e);s=r.exports}}},423:(t,e,r)=>{const{version:i}=r(306);let s;class n{static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static length(){return new Uint32Array(s.memory.buffer,s.cur_len.value,1)[0]}static copy_and_free(t,e){let r=n.u8(t,e).slice();return s.wfree(t,e),r}}t.exports={compress:function(t,e=3){const r=n.alloc(t.length);return n.u8(r,t.length).set(t),n.copy_and_free(s.compress(r,t.length,e),n.length())},decompress:function(t,e=0){const r=n.alloc(t.length);n.u8(r,t.length).set(t);const i=s.decompress(r,t.length,e);if(0===i)throw new Error("zlib: failed to decompress");return n.copy_and_free(i,n.length())},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${i}/utils/wasm/zlib.wasm`).then((e=>t?e:e.arrayBuffer()))),r=new WebAssembly.Instance(e);s=r.exports}}}},e={},function r(i){if(e[i])return e[i].exports;var s=e[i]={exports:{}};return t[i](s,s.exports,r),s.exports}(655);var t,e}));
//# sourceMappingURL=ImageScript.js.map