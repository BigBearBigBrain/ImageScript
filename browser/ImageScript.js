!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ImageScript=e():t.ImageScript=e()}(self,(function(){return t={655:(t,e,i)=>{const r=i(347),s=i(723),n=i(876),a=i(327),o=i(76),h=i(667);class l{constructor(t,e){if(e=~~e,(t=~~t)<1)throw new RangeError("Image has to be at least 1 pixel wide");if(e<1)throw new RangeError("Image has to be at least 1 pixel high");this.__width__=t,this.__height__=e,this.__buffer__=new ArrayBuffer(t*e*4),this.__view__=new DataView(this.__buffer__),this.__u32__=new Uint32Array(this.__buffer__),this.bitmap=new Uint8ClampedArray(this.__buffer__)}toString(){return`Image<${this.width}x${this.height}>`}get width(){return this.__width__}get height(){return this.__height__}*[Symbol.iterator](){for(let t=1;t<=this.height;t++)for(let e=1;e<=this.width;e++)yield[e,t]}*iterateWithColors(){let t=0;for(let e=1;e<=this.height;e++)for(let i=1;i<=this.width;i++)yield[i,e,this.__view__.getUint32(t,!1)],t+=4}static rgbaToColor(t,e,i,r){return((255&t)<<24|(255&e)<<16|(255&i)<<8|255&r)>>>0}static rgbToColor(t,e,i){return l.rgbaToColor(t,e,i,255)}static hslaToColor(t,e,i,r){let s,n,a;if(t%=1,e=Math.min(1,Math.max(0,e)),i=Math.min(1,Math.max(0,i)),r=Math.min(1,Math.max(0,r)),0===e)s=n=a=i;else{const r=(t,e,i)=>(i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t),o=i<.5?i*(1+e):i+e-i*e,h=2*i-o;s=r(h,o,t+1/3),n=r(h,o,t),a=r(h,o,t-1/3)}return l.rgbaToColor(255*s,255*n,255*a,255*r)}static hslToColor(t,e,i){return l.hslaToColor(t,e,i,1)}static rgbaToHSLA(t,e,i,r){t/=255,e/=255,i/=255;const s=Math.max(t,e,i),n=Math.min(t,e,i);let a,o,h=(s+n)/2;if(s===n)a=o=0;else{const r=s-n;switch(o=h>.5?r/(2-s-n):r/(s+n),s){case t:a=(e-i)/r+(e<i?6:0);break;case e:a=(i-t)/r+2;break;case i:a=(t-e)/r+4}a/=6}return[a,o,h,r/255]}static colorToRGBA(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]}static colorToRGB(t){return l.colorToRGBA(t).slice(0,3)}getPixelAt(t,e){return this.__check_boundaries__(t,e),this.__view__.getUint32(4*((~~e-1)*this.width+(~~t-1)),!1)}getRGBAAt(t,e){this.__check_boundaries__(t,e);const i=4*((~~e-1)*this.width+(~~t-1));return this.bitmap.subarray(i,i+4)}setPixelAt(t,e,i){return t=~~t,e=~~e,this.__check_boundaries__(t,e),this.__set_pixel__(t,e,i),this}__set_pixel__(t,e,i){this.__view__.setUint32(4*((e-1)*this.width+(t-1)),i,!1)}__check_boundaries__(t,e){if(isNaN(t))throw new TypeError(`Invalid pixel coordinates (x=${t})`);if(isNaN(e))throw new TypeError(`Invalid pixel coordinates (y=${e})`);if(t<1)throw new RangeError(`${l.__out_of_bounds__} (x=${t})<1`);if(t>this.width)throw new RangeError(`${l.__out_of_bounds__} (x=${t})>(width=${this.width})`);if(e<1)throw new RangeError(`${l.__out_of_bounds__} (y=${e})<1`);if(e>this.height)throw new RangeError(`${l.__out_of_bounds__} (y=${e})>(height=${this.height})`)}static get __out_of_bounds__(){return"Tried referencing a pixel outside of the images boundaries:"}fill(t){if("function"!=typeof t)this.__view__.setUint32(0,t,!1),this.__u32__.fill(this.__u32__[0]);else{let e=0;for(let i=1;i<=this.height;i++)for(let r=1;r<=this.width;r++)this.__view__.setUint32(e,t(r,i),!1),e+=4}return this}clone(){const t=new l(this.width,this.height);return t.bitmap.set(this.bitmap),t}static get RESIZE_NEAREST_NEIGHBOR(){return"RESIZE_NEAREST_NEIGHBOR"}static get RESIZE_AUTO(){return-1}scale(t,e=l.RESIZE_NEAREST_NEIGHBOR){const i=this.__scale__(t,e);return this.__apply__(i)}__scale__(t,e=l.RESIZE_NEAREST_NEIGHBOR){return 1===t?this:this.__resize__(this.width*t,this.height*t,e)}resize(t,e,i=l.RESIZE_NEAREST_NEIGHBOR){const r=this.__resize__(t,e,i);return this.__apply__(r)}__resize__(t,e,i=l.RESIZE_NEAREST_NEIGHBOR){if(t===l.RESIZE_AUTO&&e===l.RESIZE_AUTO)throw new Error("RESIZE_AUTO can only be used for either width or height, not for both");if(t===l.RESIZE_AUTO?t=this.width/this.height*e:e===l.RESIZE_AUTO&&(e=this.height/this.width*t),t=Math.floor(t),e=Math.floor(e),t<1)throw new RangeError("Image has to be at least 1 pixel wide");if(e<1)throw new RangeError("Image has to be at least 1 pixel high");let r;if(i!==l.RESIZE_NEAREST_NEIGHBOR)throw new Error("Invalid resize mode");return r=this.__resize_nearest_neighbor__(t,e),r}__resize_nearest_neighbor__(t,e){const i=new this.constructor(t,e);for(let r=0;r<e;r++)for(let s=0;s<t;s++){const n=Math.floor(r*this.height/e),a=Math.floor(s*this.width/t),o=4*(r*t+s),h=4*(n*this.width+a);i.__view__.setUint32(o,this.__view__.getUint32(h,!1),!1)}return i}crop(t,e,i,r){return i>this.width&&(i=this.width),r>this.height&&(r=this.height),this.__apply__(this.__crop__(~~t,~~e,~~i,~~r))}__crop__(t,e,i,r){t=~~t,e=~~e;const s=new this.constructor(i,r);for(let n=0;n<r;n++){const r=(n+e)*this.width+t;s.__u32__.set(this.__u32__.subarray(r,r+i),n*i)}return s}drawBox(t,e,i,r,s){if(t-=1,e-=1,"function"!=typeof s)return this.__fast_box__(t,e,i,r,s);for(let n=1;n<=r;n++)for(let r=1;r<=i;r++){const i=r+t,a=n+e;if(Math.min(i,a)<1||i>this.width||a>this.height)continue;const o=s(r,n);this.__set_pixel__(i,a,o)}return this}__fast_box__(t,e,i,r,s){t<0&&(i+=t,t=1),e<0&&(r+=e,e=1);const n=Math.max(Math.min(t+i,this.width),1);let a=n;for(;t<=--a;)this.__view__.setUint32(4*(a+e*this.width),s);const o=4*(n+e*this.width),h=4*(t+e*this.width);let l=Math.max(Math.min(e+r,this.height),1);for(;e<--l;)this.bitmap.copyWithin(4*(t+l*this.width),h,o);return this}drawCircle(t,e,i,r){const s=i**2;for(let n=Math.max(1,e-i);n<=Math.min(e+i,this.height);n++)for(let a=Math.max(1,t-i);a<=Math.min(t+i,this.width);a++)(a-t)**2+(n-e)**2<s&&this.__set_pixel__(a,n,"function"==typeof r?r(a-t+i,n-e+i):r);return this}cropCircle(t=!1,e=0){const i=(Math[t?"max":"min"](this.width,this.height)/2)**2,r=this.width/2,s=this.height/2;for(const[t,n]of this){const a=(t-r)**2+(n-s)**2,o=4*((n-1)*this.width+(t-1))+3;a>i?this.bitmap[o]=0:e&&(this.bitmap[o]*=Math.max(0,Math.min(1,1-a/i*e**.5)))}return this}opacity(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid opacity value");return this.__set_channel_value__(t,e,3),this}red(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.__set_channel_value__(t,e,0),this}green(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.__set_channel_value__(t,e,1),this}blue(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.__set_channel_value__(t,e,2),this}__set_channel_value__(t,e,i){for(let r=i;r<this.bitmap.length;r+=4)this.bitmap[r]=t*(e?255:this.bitmap[r])}lightness(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid lightness value");return this.fill(((i,r)=>{const[s,n,a,o]=l.rgbaToHSLA(...this.getRGBAAt(i,r));return l.hslaToColor(s,n,t*(e?1:a),o)}))}saturation(t,e=!1){if(isNaN(t)||t<0)throw new RangeError("Invalid saturation value");return this.fill(((i,r)=>{const[s,n,a,o]=l.rgbaToHSLA(...this.getRGBAAt(i,r));return l.hslaToColor(s,t*(e?1:n),a,o)}))}composite(t,e=0,i=0){e=~~e,i=~~i;for(let r=0;r<t.height;r++){let s=i+r;if(!(s<0)){if(s>=this.height)break;for(let i=0;i<t.width;i++){let n=e+i;if(n<0)continue;if(n>=this.width)break;const a=4*(n+s*this.width),o=t.__view__.getUint32(4*(i+r*t.width),!1),h=this.__view__.getUint32(a,!1);255==(255&o)?this.__view__.setUint32(a,o,!1):0==(255&o)?this.__view__.setUint32(a,h,!1):this.__view__.setUint32(a,l.__alpha_blend__(o,h),!1)}}}return this}static __alpha_blend__(t,e){const i=255&t,r=i+1,s=256-i;return(255&r*(t>>>24)+s*(e>>>24)>>8)<<24|(255&r*(t>>16&255)+s*(e>>16&255)>>8)<<16|(255&r*(t>>8&255)+s*(e>>8&255)>>8)<<8|255&Math.max(i,255&e)}invert(){for(const[t,e,i]of this.iterateWithColors())this.__set_pixel__(t,e,4294967295-i&4294967040|255&i);return this}invertValue(){for(const[t,e,i]of this.iterateWithColors()){const[r,s,n,a]=l.rgbaToHSLA(...l.colorToRGBA(i));this.__set_pixel__(t,e,l.hslaToColor(r,s,1-n,a))}return this}invertSaturation(){for(const[t,e,i]of this.iterateWithColors()){const[r,s,n,a]=l.rgbaToHSLA(...l.colorToRGBA(i));this.__set_pixel__(t,e,l.hslaToColor(r,1-s,n,a))}return this}invertHue(){for(const[t,e,i]of this.iterateWithColors()){const[r,s,n,a]=l.rgbaToHSLA(...l.colorToRGBA(i));this.__set_pixel__(t,e,l.hslaToColor(1-r,s,n,a))}return this}hueShift(t){for(const[e,i,r]of this.iterateWithColors()){const[s,n,a,o]=l.rgbaToHSLA(...l.colorToRGBA(r));this.__set_pixel__(e,i,l.hslaToColor(s+t/360,n,a,o))}return this}averageColor(){let t=[0,0,0],e=0;for(let i=0;i<this.bitmap.length;i+=4){const r=this.bitmap.subarray(i,i+4);for(let e=0;e<3;e++)t[e]+=r[e];e+=r[3]/255}return l.rgbaToColor(...t.map((t=>t/e)),255)}dominantColor(t=!0,e=!0,i=15){const r=new Array(262143);for(let s=0;s<this.bitmap.length;s+=4){const n=this.__view__.getUint32(s,!1),[a,o,h]=l.rgbaToHSLA(...l.colorToRGBA(n)).map((t=>~~(63*t)));if(t&&h<i)continue;if(e&&h>63-i)continue;const c=a<<12|o<<6|h;r[c]=(r[c]||0)+1}let s=-1,n=0;if(r.forEach(((t,e)=>{t<s||(s=t,n=e)})),-1===n)return this.dominantColor(t,e,i-1);const a=n>>>12&63,o=n>>>6&63,h=63&n;return l.hslaToColor(a/63,o/63,h/63,1)}rotate(t,e=!0){if(t%360==0)return this;if(t%180==0)return this.__rotate_180__();const i=Math.PI*(t/180),r=Math.sin(i),s=Math.cos(i),n=e?Math.abs(this.width*r)+Math.abs(this.height*s):this.width,a=e?Math.abs(this.width*s)+Math.abs(this.height*r):this.height,o=new l(n,a),h=n/2-.5,c=a/2-.5,_=this.width/2-.5,f=this.height/2-.5;let u=0;do{let t=0;const e=_-r*(u-c),i=f+s*(u-c);do{const n=e+s*(t-h),a=i+r*(t-h);l.__interpolate__(this,o,t,u,n,a)}while(t++<n)}while(u++<a);return this.__apply__(o)}__rotate_180__(){let t=0;for(this.bitmap.reverse();t<this.bitmap.length;)this.bitmap.subarray(t,t+=4).reverse();return this}static __interpolate__(t,e,i,r,s,n){const a=~~s,o=~~n,h=s-a,c=n-o,_=e.bitmap.subarray(4*(i+r*e.width),-4),f={r:0,g:0,b:0,a:0};l.__pawn__(a,o,(1-h)*(1-c),f,t),l.__pawn__(1+a,o,h*(1-c),f,t),l.__pawn__(a,1+o,(1-h)*c,f,t),l.__pawn__(1+a,1+o,h*c,f,t),_[3]=f.a,_[0]=f.r/f.a,_[1]=f.g/f.a,_[2]=f.b/f.a}static __pawn__(t,e,i,r,s){if(t>0&&e>0&&t<s.width&&e<s.height){const n=4*(t+e*s.width),a=s.bitmap.subarray(n,n+4),o=i*a[3];r.a+=o,r.r+=o*a[0],r.g+=o*a[1],r.b+=o*a[2]}}__apply__(t){return this.__width__=t.__width__,this.__height__=t.__height__,this.__view__=t.__view__,this.__u32__=t.__u32__,this.bitmap=t.bitmap,t instanceof c?c.from(this,t.duration):this}static gradient(t){const e=Object.entries(t).sort(((t,e)=>t[0]-e[0])),i=e.map((t=>parseFloat(t[0]))),r=e.map((t=>t[1]));if(0===i.length)throw new RangeError("Invalid gradient point count");if(1===i.length)return()=>r[0];if(2===i.length){const t=this.__gradient__(r[0],r[1]);return e=>e<=i[0]?r[0]:e>=i[1]?r[1]:t((e-i[0])/(i[1]-i[0]))}const s=Math.min(...i),n=Math.max(...i);let a=[];for(let t=0;t<i.length;t++){let e=i[t-1];if(void 0===e)continue;let s=i[t],n=r[t-1];void 0===n&&(n=r[t]);const o=r[t],h=this.__gradient__(n,o);a.push({min:e,max:s,gradient:h})}return t=>{if(t<=s)return a[0].gradient(0);if(t>=n)return a[a.length-1].gradient(1);for(const e of a)if(t>=e.min&&t<=e.max)return e.gradient((t-e.min)/(e.max-e.min));throw new RangeError(`Invalid gradient position: ${t}`)}}roundCorners(t=Math.min(this.width,this.height)/4){const e=t**2;for(let i=1;i<=t;i++){const r=(i-t)**2;for(let s=1;s<=t;s++)r+(s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+i-1)+3]=0)}for(let i=1;i<=t;i++){const r=(i-t)**2;for(let s=this.height-t;s<=this.height;s++)r+(this.height-s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+i-1)+3]=0)}for(let i=this.width-t;i<=this.width;i++){const r=(this.width-i-t)**2;for(let s=1;s<=t;s++)r+(s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+i-1)+3]=0)}for(let i=this.width-t;i<=this.width;i++){const r=(this.width-i-t)**2;for(let s=this.height-t;s<=this.height;s++)r+(this.height-s-t)**2>e&&(this.bitmap[4*((s-1)*this.width+i-1)+3]=0)}return this}static __gradient__(t,e){const i=t>>>24,r=t>>16&255,s=t>>8&255,n=255&t,a=(e>>>24)-i,o=(e>>16&255)-r,h=(e>>8&255)-s,l=(255&e)-n;return t=>(255&i+t*a)<<24|(255&r+t*o)<<16|(255&s+t*h)<<8|255&n+t*l}fisheye(t=2){const e=new l(this.width,this.height),i=this.width,r=this.height,s=this.__u32__,n=e.__u32__,a=1/i,o=1/r;for(const[e,h]of this){const l=e*a-.5,c=h*o-.5,_=Math.sqrt(l**2+c**2),f=2*_**t,u=(f*l/_+.5)*i|0,w=(f*c/_+.5)*r|0;u<1||u>i||w<1||w>r||isNaN(u)||isNaN(w)||(n[h*i+e]=s[i*w+u])}const h=.5*s.length+i/2;return n[h]=s[h],this.__apply__(e)}async encode(t=1){return await r.encode(this.bitmap,{width:this.width,height:this.height,level:t,channels:4})}async encodeJPEG(t=90){return await a.init(),a.encode(this.bitmap,this.width,this.height,Math.max(1,Math.min(100,t)))}static async decode(t){let e,i;if(ArrayBuffer.isView(t)?(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),i=new DataView(t.buffer,t.byteOffset,t.byteLength)):(t=new Uint8Array(t),i=new DataView(t.buffer)),u.isPNG(i)){const{width:i,height:s,pixels:n}=await r.decode(t);e=new l(i,s),e.bitmap.set(n)}else if(u.isJPEG(i)){await a.init();const i=a.decode(t),r=i.width,s=i.height,n=i.format;e=new l(r,s);const o=i.buffer;if(0===n){const t=new DataView(e.bitmap.buffer);for(let e=0;e<o.length;e++){const i=o[e];t.setUint32(4*e,i<<24|i<<16|i<<8|255,!1)}}else if(1===n){e.bitmap.fill(255);for(let t=0;t<r*s;t++)e.bitmap.set(o.subarray(3*t,3*t+3),4*t)}else if(2===n)for(let t=0;t<o.length;t+=4)e.bitmap[t]=255*(1-o[t]/255)*(1-o[t+3]/255),e.bitmap[t+1]=255*(1-o[t+1]/255)*(1-o[t+3]/255),e.bitmap[t+2]=255*(1-o[t+2]/255)*(1-o[t+3]/255),e.bitmap[t+3]=255}else{if(!u.isTIFF(i))throw new Error("Unsupported image type");{await o.init();const i=o.decode(t);e=new l(i.width,i.height),e.bitmap.set(i.buffer)}}return e}static get SVG_MODE_SCALE(){return 1}static get SVG_MODE_WIDTH(){return 2}static get SVG_MODE_HEIGHT(){return 3}static async renderSVG(t,e=1,i=this.SVG_MODE_SCALE){if(![this.SVG_MODE_WIDTH,this.SVG_MODE_HEIGHT,this.SVG_MODE_SCALE].includes(i))throw new Error("Invalid SVG scaling mode");if(i===this.SVG_MODE_SCALE&&e<=0)throw new RangeError("SVG scale must be > 0");if(i!==this.SVG_MODE_SCALE&&e<1)throw new RangeError("SVG size must be >= 1");"string"==typeof t&&(t=(new TextEncoder).encode(t)),await n.init();const r=n.rasterize(t,i,e),s=new l(r.width,r.height);return s.bitmap.set(r.buffer),s}static async renderText(t,e,i,r=4294967295,n=new f){await s.init(),t=new s.Font(e,t);const[a,o,h,c]=l.colorToRGBA(r),_=new s.Layout;_.reset({max_width:n.maxWidth,max_height:n.maxHeight,wrap_style:n.wrapStyle,vertical_align:n.verticalAlign,horizontal_align:n.horizontalAlign,wrap_hard_breaks:n.wrapHardBreaks}),_.append(t,i,{scale:e});const u=_.rasterize(a,o,h),w=new l(u.width,u.height);return w.bitmap.set(u.buffer),w.height>n.maxHeight&&w.crop(0,0,w.width,Math.floor(_.lines()/w.height*n.maxHeight)*(w.height/_.lines())),t.free(),_.free(),w.opacity(c/255)}}class c extends l{constructor(t,e,i=100,r=0,s=0){if(isNaN(i)||i<0)throw new RangeError("Invalid frame duration");super(t,e),this.duration=i,this.xOffset=r,this.yOffset=s}toString(){return`Frame<${this.width}x${this.height}x${this.duration}ms>`}static from(t,e,i,r){if(!(t instanceof l))throw new TypeError("Invalid image passed");const s=new c(t.width,t.height,e,i,r);return s.bitmap.set(t.bitmap),s}}class _ extends Array{constructor(t,e=-1){super(...t),this.width=Math.max(...t.map((t=>t.width))),this.height=Math.max(...t.map((t=>t.height)));for(const t of this)if(!(t instanceof c))throw new TypeError(`Frame ${this.indexOf(t)} is not an instance of Frame`);if(e<-1||isNaN(e))throw new RangeError("Invalid loop count");this.loopCount=e}toString(){return`GIF<${this.width}x${this.height}x${this.duration}ms>`}*[Symbol.iterator](){for(let t=0;t<this.length;t++)yield this[t]}get duration(){return this.reduce(((t,e)=>t+e.duration),0)}async encode(t=10){await h.init();const e=new h.Encoder(this.width,this.height,this.loopCount);for(const i of this){if(!(i instanceof c))throw new Error("GIF contains invalid frames");e.add(i.xOffset,i.yOffset,~~(i.duration/10),i.width,i.height,i.bitmap,t)}return e.u8()}static async decode(t,e=!1){let i,r;if(ArrayBuffer.isView(t)?(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=new DataView(t.buffer,t.byteOffset,t.byteLength)):(t=new Uint8Array(t),r=new DataView(t.buffer)),await h.init(),!u.isGIF(r))throw new Error("Unsupported image type");{await h.init();const r=new h.Decoder(t);let s=[];for(const t of r.frames()){const i=new c(t.width,t.height,10*t.delay,t.x,t.y);if(i.bitmap.set(t.buffer),s.push(i),e)break}r.free(),i=new _(s)}return i}}class f{constructor(t){const{maxWidth:e,maxHeight:i,wrapStyle:r,verticalAlign:s,horizontalAlign:n,wrapHardBreaks:a}=t??{};if(this.maxWidth=e??1/0,isNaN(this.maxWidth)||this.maxWidth<1)throw new RangeError("Invalid maxWidth");if(this.maxHeight=i??1/0,isNaN(this.maxHeight)||this.maxHeight<1)throw new RangeError("Invalid maxHeight");if(this.wrapStyle=r??"word",!["word","char"].includes(this.wrapStyle))throw new RangeError("Invalid wrapStyle");if(this.verticalAlign=s??"left",!["left","center","right"].includes(this.verticalAlign))throw new RangeError("Invalid verticalAlign");if(this.horizontalAlign=n??"top",!["top","middle","bottom"].includes(this.horizontalAlign))throw new RangeError("Invalid horizontalAlign");if(this.wrapHardBreaks=a??!0,"boolean"!=typeof this.wrapHardBreaks)throw new TypeError("Invalid wrapHardBreaks")}}class u{static getType(t){let e;return ArrayBuffer.isView(t)?(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e=new DataView(t.buffer,t.byteOffset,t.byteLength)):(t=new Uint8Array(t),e=new DataView(t.buffer)),this.isPNG(e)?"png":this.isJPEG(e)?"jpeg":this.isTIFF(e)?"tiff":this.isGIF(e)?"gif":null}static isPNG(t){return 2303741511===t.getUint32(0,!1)}static isJPEG(t){return t.getUint32(0,!1)>>>8==16767231}static isTIFF(t){return 1229531648===t.getUint32(0,!1)}static isGIF(t){return t.getUint32(0,!1)>>>8==4671814}}t.exports={Image:l,GIF:_,Frame:c,TextLayout:f,ImageType:u,decode:function(t,e){return"gif"===u.getType(t)?_.decode(t,e):l.decode(t)}}},306:t=>{"use strict";t.exports=JSON.parse('{"name":"imagescript","version":"1.2.0","description":"zero-dependency javascript image manipulation","main":"ImageScript.js","type":"commonjs","scripts":{"build":"webpack"},"repository":{"type":"git","url":"git+https://github.com/matmen/ImageScript.git"},"keywords":["image","image processing","image manipulation"],"author":"matmen <matmen@dreadful.tech>","license":"GPL-3.0-or-later","bugs":{"url":"https://github.com/matmen/ImageScript/issues"},"homepage":"https://github.com/matmen/ImageScript#readme","engines":{"node":">=12.0.0"}}')},354:t=>{t.exports=class{static concat(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let i=0;for(const r of t)e.set(r,i),i+=r.length;return e}}},883:t=>{const e=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);t.exports=function(t){let i=0,r=4294967295;for(;i<t.length-4;)r=e[255&(r^t[i++])]^r>>>8,r=e[255&(r^t[i++])]^r>>>8,r=e[255&(r^t[i++])]^r>>>8,r=e[255&(r^t[i++])]^r>>>8;for(;i<t.length;)r=e[255&(r^t[i++])]^r>>>8;return(4294967295^r)>>>0}},347:(t,e,i)=>{const r=i(883),s=i(354),{init:n,compress:a,decompress:o}=i(423),h=new Uint8Array([73,72,68,82]),l=new Uint8Array([73,68,65,84]),c=new Uint8Array([73,69,78,68]),_=r(new Uint8Array([73,69,78,68])),f=new Uint8Array([137,80,78,71,13,10,26,10]),u={1:0,2:4,3:2,4:6};t.exports={async encode(t,{width:e,height:i,channels:s,depth:o=8,level:w=0}){let g=0,d=0;const p=e*s,m=new Uint8Array(i+t.length);for(;g<t.length;)m[d++]=0,m.set(t.subarray(g,g+=p),d),d+=p;await n();const b=a(m,w),y=new Uint8Array(49+f.length+b.length);y[26]=0,y[27]=0,y[28]=0,y[24]=o,y.set(f,0),y.set(h,12),y.set(l,37),y.set(b,41),y.set(c,49+b.length),y[25]=u[s];const E=new DataView(y.buffer);return E.setUint32(8,13),E.setUint32(16,e),E.setUint32(20,i),E.setUint32(33,b.length),E.setUint32(45+b.length,0),E.setUint32(53+b.length,_),E.setUint32(29,r(new Uint8Array(y.buffer,12,17))),E.setUint32(41+b.length,r(new Uint8Array(y.buffer,37,4+b.length))),y},async decode(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);const i=e.getUint32(16),r=e.getUint32(20),a=t[24],h=t[25];let l={3:1,0:1,4:2,2:3,6:4}[h];const c=l*a/8,_=i*c;let f=new Uint8Array(r*_),u=0,w=0,g=33;const d=[];let p,m,b;for(;1229278788!==b;){if(b=e.getUint32(4+g),1229209940===b)d.push(t.subarray(8+g,8+g+e.getUint32(g)));else if(1347179589===b){if(p)throw new Error("PLTE can only occur once in an image");p=new Uint32Array(e.getUint32(g));for(let e=0;e<8*p.length;e+=3)p[e/3]=t[8+g+e]<<24|t[8+g+e+1]<<16|t[8+g+e+2]<<8|255}else if(1951551059===b){if(m)throw new Error("tRNS can only occur once in an image");m=new Uint8Array(e.getUint32(g));for(let e=0;e<m.length;e++)m[e]=t[8+g+e]}g+=12+e.getUint32(g)}for(await n(),t=o(1===d.length?d[0]:s.concat(...d));u<t.byteLength;){const e=t[u++],i=t.subarray(u,u+=_);0===e?f.set(i,w):1===e?this.filter_1(i,f,w,c,_):2===e?this.filter_2(i,f,w,c,_):3===e?this.filter_3(i,f,w,c,_):4===e&&this.filter_4(i,f,w,c,_),w+=_}if(3===h){if(!p)throw new Error("Indexed color PNG has no PLTE");if(m)for(let t=0;t<m.length;t++)p[t]&=4294967040|m[t];l=4;const t=new Uint8Array(i*r*4),e=new DataView(t.buffer,t.byteOffset,t.byteLength);for(let t=0;t<f.length;t++)e.setUint32(4*t,p[f[t]],!1);f=t}if(8!==a){const t=new Uint8Array(f.length/a*8);for(let e=0;e<f.length;e+=2)t[e/2]=f[e];f=t}if(4!==l){const t=new Uint8Array(i*r*4),e=new DataView(t.buffer);if(1===l)for(let t=0;t<i*r;t++){const i=f[t];e.setUint32(4*t,i<<24|i<<16|i<<8|255,!1)}else if(2===l)for(let t=0;t<i*r*2;t+=2){const i=f[t];e.setUint32(2*t,i<<24|i<<16|i<<8|f[t+1],!1)}else if(3===l){t.fill(255);for(let e=0;e<i*r;e++)t.set(f.subarray(3*e,3*e+3),4*e)}f=t}return{width:i,height:r,pixels:f}},filter_1(t,e,i,r,s){let n=0;for(;n<r;)e[n+i]=t[n++];for(;n<s;)e[n+i]=t[n]+e[n+++i-r]},filter_2(t,e,i,r,s){if(0===i)e.set(t,i);else{let r=0;for(;r<s;)e[r+i]=t[r]+e[r+++i-s]}},filter_3(t,e,i,r,s){let n=0;if(0===i){for(;n<r;)e[n]=t[n++];for(;n<s;)e[n]=t[n]+(e[n++-r]>>1)}else{for(;n<r;)e[n+i]=t[n]+(e[n+++i-s]>>1);for(;n<s;)e[n+i]=t[n]+(e[n+i-r]+e[n+++i-s]>>1)}},filter_4(t,e,i,r,s){let n=0;if(0===i){for(;n<r;)e[n]=t[n++];for(;n<s;)e[n]=t[n]+e[n++-r]}else{for(;n<r;)e[n+i]=t[n]+e[n+++i-s];for(;n<s;){const a=e[n+i-r],o=e[n+i-s],h=e[n+i-r-s],l=a+o-h,c=Math.abs(l-a),_=Math.abs(l-o),f=Math.abs(l-h);e[n+i]=t[n++]+(c<=_&&c<=f?a:_<=f?o:h)}}}}},723:(t,e,i)=>{const{version:r}=i(306);let s,n=null;class a{static length(){return s.wlen()}static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static copy_and_free(t,e){let i=a.u8(t,e).slice();return s.wfree(t,e),i}}const o="Deno"in globalThis?Deno.core.encode:(()=>{const t=new TextEncoder;return e=>t.encode(e)})(),h="Deno"in globalThis?Deno.core.decode:(()=>{const t=new TextDecoder;return e=>t.decode(e)})();"FinalizationRegistry"in globalThis&&(n=new FinalizationRegistry((([t,e])=>{0===t&&s.font_free(e),1===t&&s.layout_free(e)}))),t.exports={Font:class{constructor(t,e){this.scale=t;const i=a.alloc(e.length);if(a.u8(i,e.length).set(e),this.ptr=s.font_new(i,e.length,t),!this.ptr)throw new Error("invalid font");n&&n.register(this,[0,this.ptr],this)}free(){this.ptr=s.font_free(this.ptr),n&&n.unregister(this)}has(t){return s.font_has(this.ptr,String.prototype.charCodeAt.call(t,0))}metrics(t,e=this.scale){const i=s.font_metrics(this.ptr,String.prototype.charCodeAt.call(t,0),e),r=JSON.parse(h(a.u8(s.font_metrics_buffer(i),a.length())));return s.font_metrics_free(i),r}rasterize(t,e=this.scale){const i=s.font_rasterize(this.ptr,String.prototype.charCodeAt.call(t,0),e),r={buffer:a.u8(s.font_rasterize_buffer(i),a.length()).slice(),metrics:JSON.parse(h(a.u8(s.font_rasterize_metrics(i),a.length())))};return s.font_rasterize_free(i),r}},Layout:class{constructor(){this.ptr=s.layout_new(),n&&(this.refs=[]),n&&n.register(this,[1,this.ptr],this)}clear(){s.layout_clear(this.ptr),n&&(this.refs.length=0)}lines(){return s.layout_lines(this.ptr)}free(){n&&(this.refs.length=0),this.ptr=s.layout_free(this.ptr),n&&n.unregister(this)}reset(t={}){t=o(JSON.stringify(t)),n&&(this.refs.length=0);const e=a.alloc(t.length);a.u8(e,t.length).set(t),s.layout_reset(this.ptr,e,t.length)}append(t,e,i){e=o(e);const r=i||{};n&&this.refs.push(t);const h=a.alloc(e.length);a.u8(h,e.length).set(e);const l="r"in r||"g"in r||"b"in r;s.layout_append(this.ptr,t.ptr,h,e.length,null==r.scale?t.scale:r.scale,l,r.r,r.g,r.b)}rasterize(t,e,i){const r=s.layout_rasterize(this.ptr,t,e,i),n={width:s.layout_rasterize_width(r),height:s.layout_rasterize_height(r),buffer:a.u8(s.layout_rasterize_buffer(r),a.length()).slice()};return s.layout_rasterize_free(r),n}},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${r}/utils/wasm/font.wasm`).then((e=>t?e:e.arrayBuffer()))),i=await WebAssembly.instantiate(e);s=i.exports}}},667:(t,e,i)=>{const{version:r}=i(306);let s;const n=new Map;class a{static length(){return s.wlen()}static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static copy_and_free(t,e){let i=a.u8(t,e).slice();return s.wfree(t,e),i}}t.exports={Encoder:class{constructor(t,e,i=-1){this.slices=[],n.set(0,this),this.ptr=s.encoder_new(0,t,e,i)}cb(t){this.slices.push(t)}free(){this.ptr=s.encoder_free(this.ptr),n.delete(0)}u8(){this.free();let t=0;const e=new Uint8Array(this.slices.reduce(((t,e)=>t+e.length),0));for(const i of this.slices)e.set(i,t),t+=i.length;return e}add(t,e,i,r,n,o,h){const l=a.alloc(o.length);a.u8(l,o.length).set(o),s.encoder_add(this.ptr,l,o.length,t,e,r,n,i,h)}},Decoder:class{constructor(t,e=0){const i=a.alloc(t.length);if(a.u8(i,t.length).set(t),this.ptr=s.decoder_new(i,t.length,e),0===this.ptr)throw new Error("gif: failed to parse gif header");this.width=s.decoder_width(this.ptr),this.height=s.decoder_height(this.ptr)}free(){this.ptr=s.decoder_free(this.ptr)}*frames(){let t;for(;t=this.frame();)yield t}frame(){const t=s.decoder_frame(this.ptr);if(1===t)return null;if(0===t)throw this.free(),new Error("gif: failed to decode frame");const e={x:s.decoder_frame_x(t),y:s.decoder_frame_y(t),delay:s.decoder_frame_delay(t),width:s.decoder_frame_width(t),height:s.decoder_frame_height(t),buffer:a.u8(s.decoder_frame_buffer(t),a.length()).slice()};return s.decoder_frame_free(t),e}},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${r}/utils/wasm/gif.wasm`).then((e=>t?e:e.arrayBuffer()))),i=await WebAssembly.instantiate(e,{env:{push_to_stream(t,e){n.get(t).cb(a.u8(e,a.length()).slice())}}});s=i.exports}}},327:(t,e,i)=>{const{version:r}=i(306);let s;class n{static length(){return s.wlen()}static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static copy_and_free(t,e){let i=n.u8(t,e).slice();return s.wfree(t,e),i}}t.exports={encode:function(t,e,i,r){const a=n.alloc(t.length);return n.u8(a,t.length).set(t),n.copy_and_free(s.encode(a,e,i,r),n.length())},decode:function(t,e,i){const r=n.alloc(t.length);n.u8(r,t.length).set(t);const a=s.decode(r,t.length,e,i);if(0===a)throw new Error("jpg: failed to decode");if(1===a)throw new Error("jpg: failed to scale decoder");const o={width:s.decode_width(a),height:s.decode_height(a),format:s.decode_format(a),buffer:n.u8(s.decode_buffer(a),n.length()).slice()};return s.decode_free(a),o},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${r}/utils/wasm/jpeg.wasm`).then((e=>t?e:e.arrayBuffer()))),i=await WebAssembly.instantiate(e);s=i.exports}}},876:(t,e,i)=>{const{version:r}=i(306);let s;class n{static length(){return s.wlen()}static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static copy_and_free(t,e){let i=n.u8(t,e).slice();return s.wfree(t,e),i}}t.exports={rasterize:function(t,e,i){const r=n.alloc(t.length);n.u8(r,t.length).set(t);const a=s.rasterize(r,t.length,e,i);if(0===a)throw new Error("svg: failed to parse");if(1===a)throw new Error("svg: failed to rasterize");const o={width:s.rasterize_width(a),height:s.rasterize_height(a),buffer:n.u8(s.rasterize_buffer(a),n.length()).slice()};return s.rasterize_free(a),o},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${r}/utils/wasm/svg.wasm`).then((e=>t?e:e.arrayBuffer()))),i=await WebAssembly.instantiate(e);s=i.exports}}},76:(t,e,i)=>{const{version:r}=i(306);let s;class n{static length(){return s.wlen()}static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static copy_and_free(t,e){let i=n.u8(t,e).slice();return s.wfree(t,e),i}}t.exports={decode:function(t){const e=n.alloc(t.length);n.u8(e,t.length).set(t);const i=s.decode(e,t.length);if(0===i)throw new Error("tiff: failed to decode");const r={width:s.decode_width(i),height:s.decode_height(i),buffer:n.u8(s.decode_buffer(i),n.length()).slice()};return s.decode_free(i),r},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${r}/utils/wasm/tiff.wasm`).then((e=>t?e:e.arrayBuffer()))),i=await WebAssembly.instantiate(e);s=i.exports}}},423:(t,e,i)=>{const{version:r}=i(306);let s;class n{static length(){return s.wlen()}static alloc(t){return s.walloc(t)}static free(t,e){return s.wfree(t,e)}static u8(t,e){return new Uint8Array(s.memory.buffer,t,e)}static u32(t,e){return new Uint32Array(s.memory.buffer,t,e)}static copy_and_free(t,e){let i=n.u8(t,e).slice();return s.wfree(t,e),i}}t.exports={compress:function(t,e=3){const i=n.alloc(t.length);return n.u8(i,t.length).set(t),n.copy_and_free(s.compress(i,t.length,e),n.length())},decompress:function(t,e=0){const i=n.alloc(t.length);n.u8(i,t.length).set(t);const r=s.decompress(i,t.length,e);if(0===r)throw new Error("zlib: failed to decompress");return n.copy_and_free(r,n.length())},async init(){if(s)return;const t="compileStreaming"in WebAssembly,e=await WebAssembly[t?"compileStreaming":"compile"](await fetch(`https://unpkg.com/imagescript@${r}/utils/wasm/zlib.wasm`).then((e=>t?e:e.arrayBuffer()))),i=await WebAssembly.instantiate(e);s=i.exports}}}},e={},function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}(655);var t,e}));
//# sourceMappingURL=ImageScript.js.map